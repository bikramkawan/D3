const newData = [
    {
        date: '01-Apr-07',
        category: 'ignored',
        percentage: 20,
        clicked: 3,
    },
    {
        date: '03-Apr-07',
        category: 'ignored',
        percentage: 30,
        clicked: 5,
    },
    {
        date: '04-Apr-07',
        category: 'ignored',
        percentage: 10,
        clicked: 7,
    },
    {
        date: '05-Apr-07',
        category: 'ignored',
        percentage: 50,
        clicked: 1,
    },
    {
        date: '06-Apr-07',
        category: 'ignored',
        percentage: 27,
        clicked: 3,
    },
    {
        date: '07-Apr-07',
        category: 'ignored',
        percentage: 6,
        clicked: 5,
    },
    {
        date: '08-Apr-07',
        category: 'ignored',
        percentage: 5,
        clicked: 4,
    },
    {
        date: '09-Apr-07',
        category: 'ignored',
        percentage: 2,
        clicked: 1,
    },
    {
        date: '10-Apr-07',
        category: 'ignored',
        percentage: 6,
        clicked: 2,
    },

    {
        date: '01-Apr-07',
        category: 'skimmed',
        percentage: 5,
        clicked: 3,
    },
    {
        date: '03-Apr-07',
        category: 'skimmed',
        percentage: 8,
        clicked: 3,
    },
    {
        date: '04-Apr-07',
        category: 'skimmed',
        percentage: 5,
        clicked: 5,
    },
    {
        date: '05-Apr-07',
        category: 'skimmed',
        percentage: 2,
        clicked: 7,
    },
    {
        date: '06-Apr-07',
        category: 'skimmed',
        percentage: 7,
        clicked: 4,
    },
    {
        date: '07-Apr-07',
        category: 'skimmed',
        percentage: 9,
        clicked: 2,
    },
    {
        date: '08-Apr-07',
        category: 'skimmed',
        percentage: 2,
        clicked: 6,
    },
    {
        date: '09-Apr-07',
        category: 'skimmed',
        percentage: 5,
        clicked: 2,
    },
    {
        date: '10-Apr-07',
        category: 'skimmed',
        percentage: 5,
        clicked: 5,
    },

    {
        date: '01-Apr-07',
        category: 'read',
        percentage: 5,
        clicked: 5,
    },
    {
        date: '03-Apr-07',
        category: 'read',
        percentage: 7,
        clicked: 15,
    },
    {
        date: '04-Apr-07',
        category: 'read',
        percentage: 5,
        clicked: 2,
    },
    {
        date: '05-Apr-07',
        category: 'read',
        percentage: 6,
        clicked: 5,
    },
    {
        date: '06-Apr-07',
        category: 'read',
        percentage: 5,
        clicked: 5,
    },
    {
        date: '07-Apr-07',
        category: 'read',
        percentage: 5,
        clicked: 5,
    },
    {
        date: '08-Apr-07',
        category: 'read',
        percentage: 5,
        clicked: 2,
    },
    {
        date: '09-Apr-07',
        category: 'read',
        percentage: 5,
        clicked: 4,
    },
    {
        date: '10-Apr-07',
        category: 'read',
        percentage: 7,
        clicked: 3,
    },

    {
        date: '01-Apr-07',
        category: 'undeliverable',
        percentage: 8,
        clicked: 1,
    },
    {
        date: '03-Apr-07',
        category: 'undeliverable',
        percentage: 7,
        clicked: 5,
    },
    {
        date: '04-Apr-07',
        category: 'undeliverable',
        percentage: 8,
        clicked: 5,
    },
    {
        date: '05-Apr-07',
        category: 'undeliverable',
        percentage: 6,
        clicked: 7,
    },
    {
        date: '06-Apr-07',
        category: 'undeliverable',
        percentage: 5,
        clicked: 5,
    },
    {
        date: '07-Apr-07',
        category: 'undeliverable',
        percentage: 5,
        clicked: 3,
    },
    {
        date: '08-Apr-07',
        category: 'undeliverable',
        percentage: 6,
        clicked: 5,
    },
    {
        date: '09-Apr-07',
        category: 'undeliverable',
        percentage: 5,
        clicked: 7,
    },
    {
        date: '10-Apr-07',
        category: 'undeliverable',
        percentage: 5,
        clicked: 3,
    },

    {
        date: '01-Apr-07',
        category: 'out of office',
        percentage: 8,
        clicked: 5,
    },
    {
        date: '03-Apr-07',
        category: 'out of office',
        percentage: 5,
        clicked: 5,
    },
    {
        date: '04-Apr-07',
        category: 'out of office',
        percentage: 7,
        clicked: 5,
    },
    {
        date: '05-Apr-07',
        category: 'out of office',
        percentage: 7,
        clicked: 5,
    },
    {
        date: '06-Apr-07',
        category: 'out of office',
        percentage: 5,
        clicked: 3,
    },
    {
        date: '07-Apr-07',
        category: 'out of office',
        percentage: 8,
        clicked: 3,
    },
    {
        date: '08-Apr-07',
        category: 'out of office',
        percentage: 2,
        clicked: 7,
    },
    {
        date: '09-Apr-07',
        category: 'out of office',
        percentage: 5,
        clicked: 7,
    },
    {
        date: '10-Apr-07',
        category: 'out of office',
        percentage: 7,
        clicked: 8,
    },

    {
        date: '01-Apr-07',
        category: 'unsubscribed',
        percentage: 2,
        clicked: 1,
    },
    {
        date: '03-Apr-07',
        category: 'unsubscribed',
        percentage: 5,
        clicked: 3,
    },
    {
        date: '04-Apr-07',
        category: 'unsubscribed',
        percentage: 4,
        clicked: 7,
    },
    {
        date: '05-Apr-07',
        category: 'unsubscribed',
        percentage: 4,
        clicked: 2,
    },
    {
        date: '06-Apr-07',
        category: 'unsubscribed',
        percentage: 7,
        clicked: 4,
    },
    {
        date: '07-Apr-07',
        category: 'unsubscribed',
        percentage: 3,
        clicked: 1,
    },
    {
        date: '08-Apr-07',
        category: 'unsubscribed',
        percentage: 1,
        clicked: 0,
    },
    {
        date: '09-Apr-07',
        category: 'unsubscribed',
        percentage: 2,
        clicked: 1,
    },
    {
        date: '10-Apr-07',
        category: 'unsubscribed',
        percentage: 7,
        clicked: 5,
    },
];

const stackedData = [
    {
        date: '01-Apr-07',
        category: 'ignored',
        amount: 10,
    },
    {
        date: '03-Apr-07',
        category: 'ignored',
        amount: 20,
    },
    {
        date: '04-Apr-07',
        category: 'ignored',
        amount: 25,
    },
    {
        date: '05-Apr-07',
        category: 'ignored',
        amount: 5,
    },
    {
        date: '06-Apr-07',
        category: 'ignored',
        amount: 7,
    },
    {
        date: '07-Apr-07',
        category: 'ignored',
        amount: 10,
    },
    {
        date: '08-Apr-07',
        category: 'ignored',
        amount: 32,
    },
    {
        date: '09-Apr-07',
        category: 'ignored',
        amount: 2,
    },
    {
        date: '10-Apr-07',
        category: 'ignored',
        amount: 6,
    },

    {
        date: '01-Apr-07',
        category: 'skimmed',
        amount: 5,
    },
    {
        date: '03-Apr-07',
        category: 'skimmed',
        amount: 8,
    },
    {
        date: '04-Apr-07',
        category: 'skimmed',
        amount: 15,
    },
    {
        date: '05-Apr-07',
        category: 'skimmed',
        amount: 10,
    },
    {
        date: '06-Apr-07',
        category: 'skimmed',
        amount: 17,
    },
    {
        date: '07-Apr-07',
        category: 'skimmed',
        amount: 9,
    },
    {
        date: '08-Apr-07',
        category: 'skimmed',
        amount: 21,
    },
    {
        date: '09-Apr-07',
        category: 'skimmed',
        amount: 5,
    },
    {
        date: '10-Apr-07',
        category: 'skimmed',
        amount: 10,
    },

    {
        date: '01-Apr-07',
        category: 'read',
        amount: 15,
    },
    {
        date: '03-Apr-07',
        category: 'read',
        amount: 20,
    },
    {
        date: '04-Apr-07',
        category: 'read',
        amount: 5,
    },
    {
        date: '05-Apr-07',
        category: 'read',
        amount: 12,
    },
    {
        date: '06-Apr-07',
        category: 'read',
        amount: 20,
    },
    {
        date: '07-Apr-07',
        category: 'read',
        amount: 15,
    },
    {
        date: '08-Apr-07',
        category: 'read',
        amount: 5,
    },
    {
        date: '09-Apr-07',
        category: 'read',
        amount: 10,
    },
    {
        date: '10-Apr-07',
        category: 'read',
        amount: 7,
    },

    {
        date: '01-Apr-07',
        category: 'other1',
        amount: 8,
    },
    {
        date: '03-Apr-07',
        category: 'other1',
        amount: 15,
    },
    {
        date: '04-Apr-07',
        category: 'other1',
        amount: 20,
    },
    {
        date: '05-Apr-07',
        category: 'other1',
        amount: 30,
    },
    {
        date: '06-Apr-07',
        category: 'other1',
        amount: 10,
    },
    {
        date: '07-Apr-07',
        category: 'other1',
        amount: 5,
    },
    {
        date: '08-Apr-07',
        category: 'other1',
        amount: 15,
    },
    {
        date: '09-Apr-07',
        category: 'other1',
        amount: 10,
    },
    {
        date: '10-Apr-07',
        category: 'other1',
        amount: 5,
    },

    {
        date: '01-Apr-07',
        category: 'other2',
        amount: 18,
    },
    {
        date: '03-Apr-07',
        category: 'other2',
        amount: 10,
    },
    {
        date: '04-Apr-07',
        category: 'other2',
        amount: 15,
    },
    {
        date: '05-Apr-07',
        category: 'other2',
        amount: 10,
    },
    {
        date: '06-Apr-07',
        category: 'other2',
        amount: 5,
    },
    {
        date: '07-Apr-07',
        category: 'other2',
        amount: 10,
    },
    {
        date: '08-Apr-07',
        category: 'other2',
        amount: 10,
    },
    {
        date: '09-Apr-07',
        category: 'other2',
        amount: 20,
    },
    {
        date: '10-Apr-07',
        category: 'other2',
        amount: 15,
    },
];

const color = {
    ignored: '#B4C3CA',
    skimmed: '#76E49C',
    read: '#3ED772',
    other1: '#2CC7B4',
    other2: '#2CC7B4',
    undeliverable: '#2CC7B4',
    'out of office': '#2CC7B4',
    unsubscribed: '#1489c7',
};

const taskPiData = [
    {
        date: '01-Apr-07',
        category: 'ignored',
        amount: 10,
        previous: 3,
    },
    {
        date: '03-Apr-07',
        category: 'ignored',
        amount: 20,
        previous: 5,
    },
    {
        date: '04-Apr-07',
        category: 'ignored',
        amount: 25,
        previous: 7,
    },
    {
        date: '05-Apr-07',
        category: 'ignored',
        amount: 5,
        previous: 1,
    },
    {
        date: '06-Apr-07',
        category: 'ignored',
        amount: 7,
        previous: 3,
    },
    {
        date: '07-Apr-07',
        category: 'ignored',
        amount: 10,
        previous: 5,
    },
    {
        date: '08-Apr-07',
        category: 'ignored',
        amount: 32,
        previous: 10,
    },
    {
        date: '09-Apr-07',
        category: 'ignored',
        amount: 2,
        previous: 1,
    },
    {
        date: '10-Apr-07',
        category: 'ignored',
        amount: 6,
        previous: 2,
    },

    {
        date: '01-Apr-07',
        category: 'skimmed',
        amount: 5,
        previous: 3,
    },
    {
        date: '03-Apr-07',
        category: 'skimmed',
        amount: 8,
        previous: 3,
    },
    {
        date: '04-Apr-07',
        category: 'skimmed',
        amount: 15,
        previous: 5,
    },
    {
        date: '05-Apr-07',
        category: 'skimmed',
        amount: 10,
        previous: 7,
    },
    {
        date: '06-Apr-07',
        category: 'skimmed',
        amount: 17,
        previous: 10,
    },
    {
        date: '07-Apr-07',
        category: 'skimmed',
        amount: 9,
        previous: 2,
    },
    {
        date: '08-Apr-07',
        category: 'skimmed',
        amount: 21,
        previous: 12,
    },
    {
        date: '09-Apr-07',
        category: 'skimmed',
        amount: 5,
        previous: 2,
    },
    {
        date: '10-Apr-07',
        category: 'skimmed',
        amount: 10,
        previous: 5,
    },

    {
        date: '01-Apr-07',
        category: 'read',
        amount: 15,
        previous: 10,
    },
    {
        date: '03-Apr-07',
        category: 'read',
        amount: 20,
        previous: 15,
    },
    {
        date: '04-Apr-07',
        category: 'read',
        amount: 5,
        previous: 2,
    },
    {
        date: '05-Apr-07',
        category: 'read',
        amount: 12,
        previous: 10,
    },
    {
        date: '06-Apr-07',
        category: 'read',
        amount: 20,
        previous: 10,
    },
    {
        date: '07-Apr-07',
        category: 'read',
        amount: 15,
        previous: 10,
    },
    {
        date: '08-Apr-07',
        category: 'read',
        amount: 5,
        previous: 2,
    },
    {
        date: '09-Apr-07',
        category: 'read',
        amount: 10,
        previous: 4,
    },
    {
        date: '10-Apr-07',
        category: 'read',
        amount: 7,
        previous: 3,
    },

    {
        date: '01-Apr-07',
        category: 'undeliverable',
        amount: 8,
        previous: 1,
    },
    {
        date: '03-Apr-07',
        category: 'undeliverable',
        amount: 15,
        previous: 10,
    },
    {
        date: '04-Apr-07',
        category: 'undeliverable',
        amount: 20,
        previous: 5,
    },
    {
        date: '05-Apr-07',
        category: 'undeliverable',
        amount: 30,
        previous: 7,
    },
    {
        date: '06-Apr-07',
        category: 'undeliverable',
        amount: 10,
        previous: 5,
    },
    {
        date: '07-Apr-07',
        category: 'undeliverable',
        amount: 5,
        previous: 3,
    },
    {
        date: '08-Apr-07',
        category: 'undeliverable',
        amount: 15,
        previous: 5,
    },
    {
        date: '09-Apr-07',
        category: 'undeliverable',
        amount: 10,
        previous: 7,
    },
    {
        date: '10-Apr-07',
        category: 'undeliverable',
        amount: 5,
        previous: 3,
    },

    {
        date: '01-Apr-07',
        category: 'out of office',
        amount: 18,
        previous: 10,
    },
    {
        date: '03-Apr-07',
        category: 'out of office',
        amount: 10,
        previous: 5,
    },
    {
        date: '04-Apr-07',
        category: 'out of office',
        amount: 15,
        previous: 10,
    },
    {
        date: '05-Apr-07',
        category: 'out of office',
        amount: 10,
        previous: 5,
    },
    {
        date: '06-Apr-07',
        category: 'out of office',
        amount: 5,
        previous: 3,
    },
    {
        date: '07-Apr-07',
        category: 'out of office',
        amount: 10,
        previous: 3,
    },
    {
        date: '08-Apr-07',
        category: 'out of office',
        amount: 10,
        previous: 7,
    },
    {
        date: '09-Apr-07',
        category: 'out of office',
        amount: 20,
        previous: 7,
    },
    {
        date: '10-Apr-07',
        category: 'out of office',
        amount: 15,
        previous: 8,
    },

    {
        date: '01-Apr-07',
        category: 'unsubscribed',
        amount: 2,
        previous: 1,
    },
    {
        date: '03-Apr-07',
        category: 'unsubscribed',
        amount: 5,
        previous: 3,
    },
    {
        date: '04-Apr-07',
        category: 'unsubscribed',
        amount: 10,
        previous: 7,
    },
    {
        date: '05-Apr-07',
        category: 'unsubscribed',
        amount: 4,
        previous: 2,
    },
    {
        date: '06-Apr-07',
        category: 'unsubscribed',
        amount: 7,
        previous: 4,
    },
    {
        date: '07-Apr-07',
        category: 'unsubscribed',
        amount: 3,
        previous: 1,
    },
    {
        date: '08-Apr-07',
        category: 'unsubscribed',
        amount: 1,
        previous: 0,
    },
    {
        date: '09-Apr-07',
        category: 'unsubscribed',
        amount: 2,
        previous: 1,
    },
    {
        date: '10-Apr-07',
        category: 'unsubscribed',
        amount: 7,
        previous: 5,
    },
];

const width = 900;
const height = 300;

const excludeCategoryName = ['ID', 'SentDate', 'ClickCount', 'report_type_id'];

console.error('newdata',newData, stackedData, taskPiData, 'data');

const getColor = () => {
    return (
        '#' +
        '0123456789abcdef'
            .split('')
            .map(function(v, i, a) {
                return i > 5 ? null : a[Math.floor(Math.random() * 16)];
            })
            .join('')
    );
};
const colorbrewer = [
    '#f7fcfd',
    '#e5f5f9',
    '#ccece6',
    '#99d8c9',
    '#66c2a4',
    '#41ae76',
    '#238b45',
    '#006d2c',
    '#00441b',
];
const categoriesToRender = [
    {
        category: 'Ignored',
        color: '#e5f5f9',
        percentage: 'IgnoredRate',
        clickCount: 'ClickCount',
    },
    {
        category: 'Oof',
        color: '#ccece6',
        percentage: 'OofRate',
        clickCount: 'ClickCount',
    },
    {
        category: 'OpenCount',
        color: '#99d8c9',
        percentage: 'OpenRate',
        clickCount: 'ClickCount',
    },
    {
        category: 'OptOutCount',
        color: '#66c2a4',
        percentage: 'OptOutRate',
        clickCount: 'ClickCount',
    },
    {
        category: 'ReadCount',
        color: '#41ae76',
        percentage: 'ReadRate',
        clickCount: 'ClickCount',
    },
    {
        category: 'Skimmed',
        color: '#2CC7B4',
        percentage: 'SkimmedRate',
        clickCount: 'ClickCount',
    },
    {
        category: 'UndeliverableCount',
        color: '#238b45',
        percentage: 'UndeliverableRate',
        clickCount: 'ClickCount',
    },
    {
        category: 'ReplyCount',
        color: '#006d2c',
        percentage: 'ReplyRate',
        clickCount: 'ClickCount',
    },
    {
        category: 'EngagedReads',
        color: '#00441b',
        percentage: 'EngagedReadRate',
        clickCount: 'ClickCount',
    },
];

const trimString = (string, stringWidth, width) => {
    console.error(stringWidth, string, 'inside', width);
    if (stringWidth > width) {
        return 'a';
    }
};

d3.csv('data/heatmapdata.csv', function(csvdata) {
    // const filteredCategories = Object.keys(csvdata[0]).filter(
    //     d => !excludeCategoryName.includes(d),
    // );

    console.error(csvdata, 'csg');
    var strictIsoParse = d3.time.format('%Y-%m-%dT%H:%M:%S');
    const requiredFormat = d3.time.format('%d-%b-%y');
    const dateString = '2018-04-23T15:25:52';
    console.error(
        Date.parse(dateString),
        'dateobj',
        strictIsoParse.parse(dateString),
        requiredFormat(strictIsoParse.parse(dateString)),
    );
    const validDateOnlyData = csvdata
        .map(item => {
            const formatDate = strictIsoParse.parse(
                item.SentDate.split('.')[0],
            );
            return {
                ...item,
                date: formatDate ? requiredFormat(formatDate) : null,
            };
        })
        .filter(d => d.date);

    console.log(validDateOnlyData, 'fasfsaf');
    const filteredData = validDateOnlyData.map(item => {
        const mapObj = categoriesToRender.map(cat => {
            return {
                date: item.date,
                category: cat.category,
                percentage: parseFloat(item[cat.percentage]),
                clicked: parseFloat(item[cat.clickCount]),
                color: cat.color,
            };
        });

        return mapObj;
    });

    const flatten = filteredData.reduce((acc, val) => acc.concat(val), []);

    console.error(filteredData, 'fasfasdas', flatten);
    const singleHeatMap = new SingleHeatMap({ data: flatten, width, height });
    singleHeatMap.draw();
    const arrayHeatMap = new CombinedHeatMap({
        newData: flatten,
        color,
        width,
        height,
    });
    arrayHeatMap.draw();

    const stackedChart = new StackedChart({
        stackedData,
        color,
        width,
        height,
    });
    stackedChart.draw();

    const stackedScore = new ScoresInStacked({
        data: taskPiData,
        width,
        height,
    });
    stackedScore.draw();
});
