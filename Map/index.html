<!DOCTYPE html>
<style>

    .states :hover {
        fill: #146c36;
    }

    .state-borders {
        fill: none;
        stroke: #fff;
        stroke-width: 0.5px;
        stroke-linejoin: round;
        stroke-linecap: round;
        pointer-events: none;
    }

    /* Style for Custom Tooltip */
    div.tooltip {
        position: absolute;
        text-align: center;
        width: 150px;
        height: 80px;
        padding: 2px;
        font: 15px sans-serif;
        background: white;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }

    .wrapper {
        display: flex;
        justify-content: center;
        margin-top: 5%;
    }

    .logo {
        height: 200px;
        width: 250px;
        align-self: flex-end;
    }

    img {
        height: 100%;
        width: 100%
    }

</style>
<body>

<div class="wrapper">
    <div class="logo"><img src="cooltree.png"></div>
    <svg width="960" height="600"></svg>

</div>
</body>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script>

    const svg = d3.select("svg");

    const path = d3.geoPath();
    const property = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
    const stateName = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

    d3.queue()
            .defer(d3.json, 'https://d3js.org/us-10m.v1.json')
            .defer(d3.csv, 'data.csv')
            .defer(d3.tsv, 'https://gist.githubusercontent.com/mbostock/4090846/raw/07e73f3c2d21558489604a0bc434b3a5cf41a867/us-state-names.tsv')
            .awaitAll(ready);

    function ready(error, results) {
        const us = results[0];
        const raw = results[1];
        const states = results[2];

        const data = raw.filter(d=>d.country === 'USA');

        svg.append("g")
                .attr("class", "states")
                .selectAll("path")
                .data(topojson.feature(us, us.objects.states).features)
                .enter()
                .append("path")
                .attr("d", path)
                .attr('fill', '#e5e514')
//                .on("mouseover", (d)=> {
//                    const name = states.filter(e=>e.id === d.id)[0].name
//                    stateName.transition()
//                            .duration(200)
//                            .style("opacity", .9);
//                    stateName.text(name)
//                            .style("left", (d3.event.pageX) + "px")
//                            .style("top", (d3.event.pageY - 28) + "px");
//                })
//
//                .on("mouseout", (d)=> {
//                    property.transition()
//                            .duration(500)
//                            .style("opacity", 0);
//                });

        svg.append("path")
                .attr("class", "state-borders")
                .attr("d", path(topojson.mesh(us, us.objects.states, (a, b)=> a !== b)));

        // D3 Projection
        const projection = d3.geoAlbersUsa()
                .translate([960 / 2, 600 / 2])    // translate to center of screen
                .scale([1000]);          // scale things down so see entire US

        svg.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", (d)=> {
                    const project = projection([d.longitude, d.latitude]);
                    if (project) return project[0]
                })
                .attr("cy", (d)=> {
                    const project = projection([d.longitude, d.latitude]);
                    if (project) return project[1]
                })
                .attr("r", d=> 4)
                .style("fill", "rgb(217,91,67)")
                .style("opacity", 0.85)
                .on("mouseover", (d)=> {
                    console.log(d)
                    property.transition()
                            .duration(200)
                            .style("opacity", .9);
                    property.text(d.location)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                })

                // fade out tooltip on mouse out
                .on("mouseout", (d)=> {
                    property.transition()
                            .duration(500)
                            .style("opacity", 0);
                });
    }
    // Based on https://bl.ocks.org/mbostock/4090848

</script>
